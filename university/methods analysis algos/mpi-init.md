# Инициализация среды `MPI`

[<- Назад (Методы построения и анализа алгоритмов)](https://github.com/boorlakov/zettelkasten/blob/main/university/methods%20analysis%20algos/README.md)

## About

1. Для использования `MPI` в среде разработки `MS Visual Studio` необходимо в настройках проекта указать путь к заголовочным файлам:

   `Проект -> свойства конфигурации -> C/C++ -> Общие -> Дополнительные каталоги включаемых файлов = C:\Program Files (x86)\Microsoft SDKs\MPI\Include`

2. Указать путь  к файлам статических библиотек:

   `Проект -> свойства конфигурации -> Компоновщик -> Общие -> Дополнительные каталоги библиотек = "C:\Program Files (x86)\Microsoft SDKs\MPI\lib)`

3. Подключить библиотеку `msmpi.lib`:

   `Проект -> свойства конфигурации -> Компоновщик -> Ввод -> Дополнительные зависимости`

Расположение каталогов с предустановленным `MPI` может отличаться от вышеуказанных.

Процессы, запущенные менеджером процессов `smpd.exe` на удаленных компьютерах, уже выполняются параллельно, однако для обмена сообщений между ними необходимо инициализировать среду `MPI`.

### Следующий код демонстрирует пример инициализации и завершения среды `MPI`

```c
#include “mpi.h”
int main(int argc, char** argv)
{
    int rank, size;
    MPI_Init(&argc, &argv);
    MPI_Comm_rank(MPI_COMM_WORLD,&rank);
    MPI_Comm_size(MPI_COMM_WORLD,&size);

    // Ваш код (...)

    MPI_Finalize();
    return 0;
}
```

Функция `MPI_Init(&argc, &argv)` инициализирует среду `MPI` и передает аргументы командной строки всем порождаемым процессам на удаленных машинах

Все `MPI`-процессы объединяются в так называемые коммуникаторы. Обмен сообщениями между `MPI`-процессами возможен только внутри коммуникатора. В рассматриваемом примере создается коммуникатор `MPI_COMM_WORLD`, в котором все процессы связаны по полному графу

Функция `MPI_Comm_size(MPI_COMM_WORLD, &size)` позволяет узнать количество процессов в коммуникаторе

Функция `MPI_Comm_rank(MPI_COMM_WORLD, &rank)` позволяет узнать ранг (номер) процесса в коммуникаторе. Различные `MPI`-процессы идентифицируются по этому рангу. Ранги процессов нумеруются от `0` до `size - 1`

Перед завершением программы, после того как закончен обмен между процессами, необходимо вызвать функцию `MPI_Finalize()`. Данная функция корректно завершает работу в среде `MPI`. Без вызова данной функции возможно подвисание процессов, запущенных на удаленных машинах
